--Corrige la tabla de empleados para que haya un solo gerente general segun los criterios del enunciado (maximo sueldo, y si hay iguales, por antiguedad)

CREATE PROCEDURE Ej3
@empleados_sin_jefe integer OUTPUT


AS
BEGIN


SELECT @empleados_sin_jefe = COUNT(*) FROM Empleado WHERE empl_jefe is null

if @empleados_sin_jefe > 1 
	BEGIN
	DECLARE @idGerenteGeneral numeric(6)
	DECLARE @resultado integer
		
	SELECT @resultado = COUNT(*) FROM Empleado where empl_salario = (SELECT MAX(empl_salario) FROM Empleado) 
		and empl_jefe is null
		
	if(@resultado > 1)
	begin
	print 'resultado mayorr a 1 '	
	SELECT @idGerenteGeneral = empl_codigo FROM Empleado where empl_salario = (SELECT MAX(empl_salario) FROM Empleado) 
		and empl_jefe is null and DATEDIFF(day,empl_ingreso,GETDATE()) = (SELECT MAX(DATEDIFF(day,empl_ingreso, GETDATE())) FROM Empleado)
	end
	else 
	SELECT @idGerenteGeneral = empl_codigo FROM Empleado where empl_salario = (SELECT MAX(empl_salario) FROM Empleado) 
		and empl_jefe is null	


	UPDATE  EMPLEADO SET empl_jefe = @idGerenteGeneral where empl_codigo != @idGerenteGeneral and empl_jefe is null
	
	END
	




END
